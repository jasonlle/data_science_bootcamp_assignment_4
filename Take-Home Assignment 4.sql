CREATE TABLE SALES(
	Date DATE, 
     Order_id INT(50), 
     Item_id INT(50), 
     Customer_id INT(50), 
     Quantity INT(10), 
     Revenue DECIMAL (5,2)
);

CREATE TABLE ITEMS(
     Item_id INT(50), 
     Item_name VARCHAR(50), 
     price DECIMAL (5,2),
     department VARCHAR(50)
);

CREATE TABLE CUSTOMERS(
     customer_id int(50), 
     first_name VARCHAR(50), 
     last_name VARCHAR(50),
     Address VARCHAR(50)
);

INSERT INTO Sales (Date, Order_id, Item_id, Customer_id, Quantity, Revenue) VALUES
('2023-03-18', 1001, 1, 101, 2, 30.00),
('2023-03-18', 1002, 2, 102, 1, 15.00),
('2023-03-18', 1003, 3, 103, 1, 20.00),
('2023-03-18', 1004, 4, 104, 3, 45.00),
('2023-01-15', 1005, 1, 105, 1, 15.00),
('2023-01-20', 1006, 2, 106, 2, 30.00),
('2022-07-12', 1007, 5, 107, 1, 10.00),
('2022-12-01', 1008, 3, 108, 4, 80.00),
('2022-06-23', 1009, 6, 109, 2, 25.00);

INSERT INTO ITEMS (Item_id, Item_name, Price, Department) VALUES
(1, 'Widget A', 15.00, 'Home'),
(2, 'Gadget B', 15.00, 'Electronics'),
(3, 'Tool C', 20.00, 'Home'),
(4, 'Appliance D', 15.00, 'Kitchen'),
(5, 'Accessory E', 10.00, 'Electronics'),
(6, 'Equipment F', 12.50, 'Sporting Goods');

INSERT INTO CUSTOMERS (Customer_id, First_name, Last_name, Address) VALUES
(101, 'John', 'Doe', '123 Maple St, NY'),
(102, 'Alice', 'Smith', '456 Oak St, CA'),
(103, 'Bob', 'Johnson', '789 Pine St, TX'),
(104, 'Carol', 'White', '321 Elm St, NY'),
(105, 'John', 'Smith', '654 Cedar St, FL'),
(106, 'David', 'Brown', '987 Walnut St, TX'),
(107, 'Jane', 'Wilson', '147 Birch St, NY'),
(108, 'Michael', 'Lee', '258 Aspen St, CO'),
(109, 'Sarah', 'Taylor', '369 Spruce St, NV');

-- 1. Pull the number of orders on March 18th

SELECT COUNT(DISTINCT Order_id) AS Total_orders
FROM SALES
WHERE Date = '2023-03-18';

-- 2. Pull the number of orders on March 18th by John Doe

SELECT COUNT(DISTINCT Sale.Order_id) as Total_orders
FROM SALES Sale
JOIN CUSTOMERS JohnDoe ON Sale.Customer_id = JohnDoe.Customer_id
WHERE Sale.Date = '2023-03-18'
  AND JohnDoe.First_name = 'John'
  AND JohnDoe.Last_name = 'Doe';

-- 3. Pull total number of customers that purchased in January 2023 and the average amount spend per customer

SELECT COUNT(DISTINCT Customer_id) AS Customers,
       AVG(Total_Sale) AS Revenue
FROM (
    SELECT Customer_id, SUM(Sale) AS Total_Sale
    FROM SALES
    WHERE Date BETWEEN '2023-01-01' AND '2023-01-31'
    GROUP BY Customer_id
) AS Customer_Revenue;

-- 4. Pull the departments that generated less than $600 in 2022

SELECT I.Department, SUM(Sale.Revenue) AS Revenue
FROM SALES Sale
JOIN ITEMS Item ON Sale.id = Item.id
WHERE Sale.Date BETWEEN '2022-01-01' AND '2022-12-31'
GROUP BY Item.Department
HAVING SUM(Sale.Revenue) < 600;

-- 5. What is the most and least revenue we have generated by an order

SELECT MAX(Revenue) AS High,
       MIN(Revenue) AS Low
FROM (
    SELECT Order_id, SUM(Revenue) AS Revenue
    FROM SALES
    GROUP BY Order_id
) AS Revenues;

-- 6. What were the orders that were purchased in our most lucrative order

SELECT Sale.Date, Sale.Order_id, Sale.Item_id, Sale.Customer_id, Sale.Quantity, Sale.Revenue
FROM SALES Sale
JOIN (
    SELECT Order_id
    FROM SALES
    GROUP BY Order_id
    ORDER BY SUM(Revenue) DESC
    LIMIT 1
) AS Lucrative ON sale.Order_id = Lurcative.Order_id;
